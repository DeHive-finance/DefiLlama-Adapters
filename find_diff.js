const fromBack = [
  {
    "id": 4,
    "networkId": 56,
    "symbol": "DBSC",
    "decimals": 18,
    "tvl": 34903.24,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:01.475177 +00:00"
  },
  {
    "id": 5,
    "networkId": 100,
    "symbol": "DXIN",
    "decimals": 18,
    "tvl": 36172.63,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:02.459666 +00:00"
  },
  {
    "id": 6,
    "networkId": 100,
    "symbol": "DXDC",
    "decimals": 18,
    "tvl": 115931.68,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:03.433316 +00:00"
  },
  {
    "id": 1,
    "networkId": 1,
    "symbol": "DECR",
    "decimals": 18,
    "tvl": 3491.84,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:05.068222 +00:00"
  },
  {
    "id": 2,
    "networkId": 137,
    "symbol": "DPOL",
    "decimals": 18,
    "tvl": 39783.44,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:05.680080 +00:00"
  },
  {
    "id": 3,
    "networkId": 137,
    "symbol": "DGAME",
    "decimals": 18,
    "tvl": 13569.76,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:06.304100 +00:00"
  },
  {
    "id": 36,
    "networkId": 100,
    "symbol": "DXIN",
    "tvl": 36169.74,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:09.754456 +00:00"
  },
  {
    "id": 26,
    "networkId": 56,
    "symbol": "CAKE-BUSDT-IMPULSE",
    "tvl": 0.00,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:12.699463 +00:00"
  },
  {
    "id": 33,
    "networkId": 56,
    "symbol": "PANCAKE-DHV-BUSD",
    "tvl": 88342.73,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:16.028990 +00:00"
  },
  {
    "id": 20,
    "networkId": 56,
    "symbol": "CAKE-BUSD-IMPULSE",
    "tvl": 8.51,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:19.160408 +00:00"
  },
  {
    "id": 31,
    "networkId": 56,
    "symbol": "AVAX-WBNB-IMPULSE",
    "tvl": 0.00,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:21.320649 +00:00"
  },
  {
    "id": 10,
    "networkId": 137,
    "symbol": "USDC-MATIC-IMPULSE",
    "tvl": 1154.33,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:24.731646 +00:00"
  },
  {
    "id": 32,
    "networkId": 56,
    "symbol": "DBSC",
    "tvl": 33846.70,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:26.694803 +00:00"
  },
  {
    "id": 6,
    "networkId": 137,
    "symbol": "QCK-DHV-QUICK",
    "tvl": 83.58,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:28.499341 +00:00"
  },
  {
    "id": 12,
    "networkId": 137,
    "symbol": "AVAX-WETH-IMPULSE",
    "tvl": 1897.76,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:29.939097 +00:00"
  },
  {
    "id": 7,
    "networkId": 137,
    "symbol": "DHV-QUICK-IMPULSE",
    "tvl": 122.56,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:31.296548 +00:00"
  },
  {
    "id": 24,
    "networkId": 56,
    "symbol": "ALPACA-BUSD-IMPULSE",
    "tvl": 1.83,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:33.180361 +00:00"
  },
  {
    "id": 2,
    "networkId": 1,
    "symbol": "UNI-DHV-WETH",
    "tvl": 188415.35,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:37.292043 +00:00"
  },
  {
    "id": 23,
    "networkId": 56,
    "symbol": "XVS-WBNB-IMPULSE",
    "tvl": 6.30,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:41.451893 +00:00"
  },
  {
    "id": 3,
    "networkId": 137,
    "symbol": "DHV",
    "tvl": 125920.74,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:41.862276 +00:00"
  },
  {
    "id": 29,
    "networkId": 56,
    "symbol": "BANANA-BUSD-IMPULSE",
    "tvl": 0.00,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:45.074030 +00:00"
  },
  {
    "id": 1,
    "networkId": 1,
    "symbol": "DHV",
    "tvl": 127650.44,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:46.030948 +00:00"
  },
  {
    "id": 9,
    "networkId": 137,
    "symbol": "USDC-QUICK-IMPULSE",
    "tvl": 755.41,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:49.330933 +00:00"
  },
  {
    "id": 14,
    "networkId": 137,
    "symbol": "CRV-WETH-IMPULSE",
    "tvl": 1966.00,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:56.917061 +00:00"
  },
  {
    "id": 28,
    "networkId": 56,
    "symbol": "BANANA-WBNB-IMPULSE",
    "tvl": 102.80,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:00.123956 +00:00"
  },
  {
    "id": 27,
    "networkId": 56,
    "symbol": "DODO-WBNB-IMPULSE",
    "tvl": 39.73,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:03.265632 +00:00"
  },
  {
    "id": 18,
    "networkId": 137,
    "symbol": "CRV-IMPULSE",
    "tvl": 1696.23,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:10.128237 +00:00"
  },
  {
    "id": 13,
    "networkId": 137,
    "symbol": "WMATIC-WETH-IMPULSE",
    "tvl": 1846.99,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:11.544397 +00:00"
  },
  {
    "id": 37,
    "networkId": 100,
    "symbol": "DXDC",
    "tvl": 115120.02,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:12.529436 +00:00"
  },
  {
    "id": 30,
    "networkId": 56,
    "symbol": "TWT-WBNB-IMPULSE",
    "tvl": 0.00,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:14.362160 +00:00"
  },
  {
    "id": 15,
    "networkId": 137,
    "symbol": "SNX-WETH-IMPULSE",
    "tvl": 1170.19,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:15.678290 +00:00"
  },
  {
    "id": 5,
    "networkId": 137,
    "symbol": "DGAME",
    "tvl": 10968.30,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:16.503058 +00:00"
  },
  {
    "id": 25,
    "networkId": 56,
    "symbol": "LINK-WBNB-IMPULSE",
    "tvl": 0.00,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:24.386057 +00:00"
  },
  {
    "id": 4,
    "networkId": 137,
    "symbol": "DPOL",
    "tvl": 37985.25,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:25.292955 +00:00"
  },
  {
    "id": 16,
    "networkId": 137,
    "symbol": "WMATIC-GHST-IMPULSE",
    "tvl": 2515.30,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:28.786226 +00:00"
  },
  {
    "id": 22,
    "networkId": 56,
    "symbol": "BUSDT-WBNB-IMPULSE",
    "tvl": 5.10,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:31.433329 +00:00"
  },
  {
    "id": 17,
    "networkId": 137,
    "symbol": "QCK-DHV-QUICK-NEW",
    "tvl": 133.62,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:56:33.560036 +00:00"
  },
  {
    "id": 35,
    "networkId": 100,
    "symbol": "HONEY-DHV-WXDAI",
    "tvl": 18216.24,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 12:00:02.583811 +00:00"
  },
  {
    "id": 8,
    "networkId": 137,
    "symbol": "WETH-DAI-IMPULSE",
    "tvl": 1699.09,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 12:00:03.952017 +00:00"
  },
  {
    "id": 11,
    "networkId": 137,
    "symbol": "MAI-USDT-IMPULSE",
    "tvl": 20031.42,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 12:00:05.264119 +00:00"
  },
  {
    "id": 19,
    "networkId": 56,
    "symbol": "DHV",
    "tvl": 101113.01,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 12:00:05.769171 +00:00"
  },
  {
    "id": 34,
    "networkId": 100,
    "symbol": "DHV",
    "tvl": 39734.66,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 12:00:06.281032 +00:00"
  },
  {
    "id": 21,
    "networkId": 56,
    "symbol": "BUSDT-USDC-IMPULSE",
    "tvl": 109.49,
    "apr": null,
    "apy": null,
    "createdAt": "2022-01-13 07:20:39.818857 +00:00",
    "updatedAt": "2022-01-21 11:55:02.403284 +00:00"
  }
];

const fromDefiLama =
  [
    {
      "networkId": 1,
      "symbol": "DHV",
      "tvl": 128850.78428353873,
      "type": "solo"
    },
    {
      "networkId": 1,
      "symbol": "UNI-DHV-WETH",
      "tvl": 189562.97782709787,
      "type": "lp"
    },
    {
      "networkId": 137,
      "symbol": "DHV",
      "tvl": 127104.82076806402,
      "type": "solo"
    },
    {
      "networkId": 137,
      "symbol": "DPOL",
      "tvl": 41152.5639752414,
      "type": "cluster"
    },
    {
      "networkId": 137,
      "symbol": "DGAME",
      "tvl": 15590.238415259582,
      "type": "cluster"
    },
    {
      "networkId": 137,
      "symbol": "CRV-IMPULSE",
      "tvl": 1696.0593090953785,
      "type": "impulse-multiple"
    },
    {
      "networkId": 137,
      "symbol": "DHV-QUICK-IMPULSE",
      "tvl": 259.7139201558814,
      "type": "impulse"
    },
    {
      "networkId": 137,
      "symbol": "WETH-DAI-IMPULSE",
      "tvl": 3434.52339403935,
      "type": "impulse"
    },
    {
      "networkId": 137,
      "symbol": "USDC-QUICK-IMPULSE",
      "tvl": 3313.3267628141257,
      "type": "impulse"
    },
    {
      "networkId": 137,
      "symbol": "MAI-USDT-IMPULSE",
      "tvl": 79887.93844351538,
      "type": "impulse"
    },
    {
      "networkId": 137,
      "symbol": "AVAX-WETH-IMPULSE",
      "tvl": 2062.9802770134434,
      "type": "impulse"
    },
    {
      "networkId": 137,
      "symbol": "WMATIC-WETH-IMPULSE",
      "tvl": 3706.8248595055,
      "type": "impulse"
    },
    {
      "networkId": 137,
      "symbol": "CRV-WETH-IMPULSE",
      "tvl": 2963.542977754839,
      "type": "impulse"
    },
    {
      "networkId": 137,
      "symbol": "SNX-WETH-IMPULSE",
      "tvl": 1795.2979138064784,
      "type": "impulse"
    },
    {
      "networkId": 137,
      "symbol": "WMATIC-GHST-IMPULSE",
      "tvl": 3837.357699683602,
      "type": "impulse"
    },
    {
      "networkId": 137,
      "symbol": "QCK-DHV-QUICK",
      "tvl": 3837.357699683602,
      "type": "external"
    },
    {
      "networkId": 137,
      "symbol": "QCK-DHV-QUICK-NEW",
      "tvl": 3837.357699683602,
      "type": "external"
    },
    {
      "networkId": 56,
      "symbol": "DHV",
      "tvl": 102063.81605838797,
      "type": "solo"
    },
    {
      "networkId": 56,
      "symbol": "DBSC",
      "tvl": 35188.305882191904,
      "type": "cluster"
    },
    {
      "networkId": 56,
      "symbol": "PANCAKE-DHV-BUSD",
      "tvl": 88806.82278579575,
      "type": "lp"
    },
    {
      "networkId": 56,
      "symbol": "CAKE-BUSD-IMPULSE",
      "tvl": 8.557998768235372,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "BUSDT-USDC-IMPULSE",
      "tvl": 109.49213568864107,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "BUSDT-WBNB-IMPULSE",
      "tvl": 5.107085620330732,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "XVS-WBNB-IMPULSE",
      "tvl": 6.311753810339351,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "ALPACA-BUSD-IMPULSE",
      "tvl": 1.8322096383697435,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "LINK-WBNB-IMPULSE",
      "tvl": 0,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "CAKE-BUSDT-IMPULSE",
      "tvl": 0,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "DODO-WBNB-IMPULSE",
      "tvl": 39.82979370498473,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "BANANA-WBNB-IMPULSE",
      "tvl": 102.60166130224705,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "BANANA-BUSD-IMPULSE",
      "tvl": 0,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "TWT-WBNB-IMPULSE",
      "tvl": 0,
      "type": "impulse"
    },
    {
      "networkId": 56,
      "symbol": "AVAX-WBNB-IMPULSE",
      "tvl": 0,
      "type": "impulse"
    },
    {
      "networkId": 100,
      "symbol": "DHV",
      "tvl": 0,
      "type": "solo"
    },
    {
      "networkId": 100,
      "symbol": "DXIN",
      "tvl": 26297.346710717953,
      "type": "cluster"
    },
    {
      "networkId": 100,
      "symbol": "DXDC",
      "tvl": 104042.7206504442,
      "type": "cluster"
    },
    {
      "networkId": 100,
      "symbol": "HONEY-DHV-WXDAI",
      "tvl": 6365.284535885795,
      "type": "lp"
    }
  ];


const findRecord = (networkId, symbol, where) => {
  for (let i = 0; i < where.length; i++) {
    if (where[i].networkId === networkId && where[i].symbol === symbol) {
      return where[i];
    }
  }
  return null;
};


(() => {
  const diffAccuracy = 1.1;
  let tvlNotFound = 0;
  for (let i = 0; i < fromBack.length; i++) {
    const recordWhere = fromBack[i];
    const recordWhat = findRecord(recordWhere.networkId, recordWhere.symbol, fromDefiLama);
    if (recordWhat === null) {
      console.log("--------record not found--------------");
      console.log(JSON.stringify(recordWhere, null, 4));
      tvlNotFound += recordWhere.tvl;
      continue;
    }
    let tvl1 = recordWhat.tvl;
    let tvl2 = recordWhere.tvl;
    if (recordWhat.tvl > recordWhere.tvl) {
      tvl1 = recordWhere.tvl;
      tvl2 = recordWhat.tvl;
    }
    if (tvl2 / tvl1 >= diffAccuracy || (tvl1 === 0 && tvl2 !== 0) || (tvl2 === 0 && tvl1 !== 0)) {
      console.log("----------------------");
      console.log(JSON.stringify(recordWhere, null, 4));
      console.log(JSON.stringify(recordWhat, null, 4));
    }
  }
  console.log('tvlNotFound', tvlNotFound);
})();





// DGAME    15202.68
// DBSC     38152.89
// DXIN     38713.49
// DXDC     78008.53




// --------record not found-------------- skip in defilama
//   {
//     "id": 10,
//     "networkId": 137,
//     "symbol": "USDC-MATIC-IMPULSE",
//     "tvl": 1295.68,
//     "apr": null,
//     "apy": null,
//     "createdAt": "2022-01-13 07:20:39.818857 +00:00",
//     "updatedAt": "2022-01-17 11:38:58.295000 +00:00"
//   }


//
// --------record not found--------------  DECR missing in defilama!
//   {
//     "id": 1,
//     "networkId": 1,
//     "symbol": "DECR",
//     "decimals": 18,
//     "tvl": 4334,
//     "createdAt": "2022-01-13 07:20:39.818857 +00:00",
//     "updatedAt": "2022-01-17 11:42:02.511622 +00:00"
//   }




// ---------------------- check it
//   {
//     "id": 2,
//     "networkId": 137,
//     "symbol": "DPOL",
//     "decimals": 18,
//     "tvl": 53734.65,
//     "createdAt": "2022-01-13 07:20:39.818857 +00:00",
//     "updatedAt": "2022-01-17 11:42:03.329266 +00:00"
//   }
// {
//   "networkId": 137,
//   "symbol": "DPOL",
//   "tvl": 184977.16282787645
// }


let ANSI_RESET = "\u001B[0m";
let ANSI_BLACK = "\u001B[30m";
let ANSI_RED = "\u001B[31m";
let ANSI_GREEN = "\u001B[32m";
let ANSI_YELLOW = "\u001B[33m";
let ANSI_BLUE = "\u001B[34m";
let ANSI_PURPLE = "\u001B[35m";
let ANSI_CYAN = "\u001B[36m";
let ANSI_WHITE = "\u001B[37m";
(() => {
  let tvlNotFound = 0;
  let totalBalance = 0;
  for (let i = 0; i < fromBack.length; i++) {
    const recordWhere = fromBack[i];
    const recordWhat = findRecord(recordWhere.networkId, recordWhere.symbol, fromDefiLama);
    if (recordWhat === null) {
      console.log(ANSI_CYAN)
      console.log(recordWhere.networkId, recordWhere.symbol, recordWhere.tvl, "record not found in defilama")
      tvlNotFound += recordWhere.tvl;
      continue;
    }
    let tvl1 = recordWhat.tvl;
    let tvl2 = recordWhere.tvl;
    if (recordWhat.tvl > recordWhere.tvl) {
      tvl1 = recordWhere.tvl;
      tvl2 = recordWhat.tvl;
    }
    let balance = recordWhat.tvl - recordWhere.tvl;
    totalBalance += balance;
    if (balance > 0)
      console.log(ANSI_GREEN)
    else
      console.log(ANSI_RED)

    console.log(recordWhere.networkId, recordWhere.symbol, recordWhat.type, balance)
  }

  for (let i = 0; i < fromDefiLama.length; i++) {
    const recordWhere = fromDefiLama[i];
    const recordWhat = findRecord(recordWhere.networkId, recordWhere.symbol, fromBack);
    if (recordWhat === null) {
      console.log(ANSI_PURPLE)
      console.log(recordWhere.networkId, recordWhere.symbol, recordWhere.tvl, "record not found in our backend")
      tvlNotFound += recordWhere.tvl;
      continue;
    }
  }
  console.log(ANSI_RESET)
  console.log('total balance sum', totalBalance)
})();


(() => {
  let tvlNotFound = 0;
  let totalBalance = 0;
  for (let i = 0; i < fromBack.length; i++) {
    totalBalance += fromBack[i].tvl;
  }
  console.log('back totalBalance', totalBalance)
  totalBalance = 0;
  for (let i = 0; i < fromDefiLama.length; i++) {
    totalBalance += fromDefiLama[i].tvl;
  }
  console.log('defilama totalBalance', totalBalance)
})();